<% if controller && controller.class.name == 'WikiController' && controller.action_name == "show" %>
  <% if @page && @page.id && @page.visible? %>
    <% if @page&.project&.enabled_modules&.any? { |enabled_module| enabled_module.name == 'wiki' } %>
      <% if User.current.respond_to?(:can_edit_permissions?) && User.current.can_edit_permissions?(@page) %>
        <%= link_to("Zugriff", { action: 'permissions', id: @page.title, project_id: @project }, class: 'icon icon-permissions') %>
      <% end %>
    <% end %>

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            const contextMenuEdit = document.querySelector('#content .contextual .icon-edit');
            const iconPermissions = document.querySelector('.icon-permissions');

            if (contextMenuEdit && iconPermissions && contextMenuEdit.parentNode) {
                contextMenuEdit.parentNode.insertBefore(iconPermissions, contextMenuEdit);
            }

            <% if User.current.respond_to?(:can_edit?) %>
                <% unless User.current.can_edit?(@page) %>
                    ['.icon-edit', '.icon-lock', '.icon-rename', '.icon-move', '.icon-del'].forEach(function (selector) {
                        const el = document.querySelector(selector);

                        if (el) {
                            el.style.display = 'none';
                        }
                    });
                <% end %>
            <% end %>
        });
    </script>
  <% end %>
<% end %>

<% if controller && controller.class.name == 'WikiController' && controller.action_name == "history" %>
  <% if @page && @page.id && @page.visible? %>
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            <% if User.current.respond_to?(:can_edit?) %>
                <% unless User.current.can_edit?(@page) %>
                    ['#content .icon-del', '#content .icon-annotate'].forEach(function (selector) {
                        document.querySelectorAll(selector).forEach(function (el) {
                            el.style.display = 'none';
                        });
                    });
                <% end %>
            <% end %>
        });
    </script>
  <% end %>
<% end %>
